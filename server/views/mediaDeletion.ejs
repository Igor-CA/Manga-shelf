<div style="background-color: #fafafa">
    <%- await include('./header.ejs') %>

    <div
        style="
            margin: 0 auto;
            max-width: 720px;
            padding: 30px 0;
            font-family: Arial;
            background-color: #fafafa;
            color: #3d4e66;
        "
    >
        <h2>Olá <%= username %></h2>
        
        <% 
            const baseUrl = process.env.SITE_DOMAIN; 
            const parseRichText = (text) => {
                if (!text) return "";
                let parsed = text;

                parsed = parsed.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                parsed = parsed.replace(/\[\[(.*?)\|(.*?)\]\]/g, (match, label, url) => {
                    const fullUrl = url.startsWith('http') ? url : `${baseUrl}${url}`;
                    return `<a href="${fullUrl}" style="color: #1e3a8a; text-decoration: none; font-weight: bold;">${label}</a>`;
                });

                parsed = parsed.replace(/@(\w+)/g, `<a href="${baseUrl}/user/$1" style="color: #1e3a8a; text-decoration: none;">@$1</a>`);

                return parsed;
            };
        %>

        <p>
            <%- parseRichText(notification.text) %>
        </p>

		<ul>
            for (let i = 0; i < notification.details.length; i++) { 
                let message = parseRichText(notification.details[i]); 
            %>
            <li style="margin-bottom: 10px; line-height: 1.5;">
                <%- message %>
            </li>
            <% } %>

		</ul>
        <p>
            Se você acredita que isso foi um erro, entre em contato com o suporte.
        </p>
    </div>
    
    <%- await include('./footer.ejs') %>
</div>